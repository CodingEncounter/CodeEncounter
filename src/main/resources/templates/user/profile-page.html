<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://thymeleaf.org">
<head th:replace="partials/head :: head('Profile')">
    <meta charset="UTF-8" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <title>Title</title>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.9.2/mapbox-gl.css" rel="stylesheet">
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.0/mapbox-gl-directions.css" type="text/css">
</head>
<style>
    @import url("https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css");

    @font-face {
        font-family: Poppins;
        font-style: normal;
        font-weight: 400;
        src: url("https://fonts.animaapp.com/Monaco-Regular") format("truetype");
    }

    :root {
        --black: #000000;
        --white: #ffffff;
        --dove-gray: #707070;
        --font-size-m2: 20px;
        --font-size-m3: 14px;
        --font-family-monaco-regular: Monaco;
    }

    * {
        box-sizing: border-box;
    }

    .hidden,
    .hidden * {
        pointer-events: none;
        visibility: hidden;
    }
    .image {
        height: 300px;
        width: 280px;
        border-radius: 8px;
    }

    * {
        box-sizing: border-box;
    }

    body {
        font-family: Poppins;
    }

    /* Float four columns side by side */
    .column {
        float: left;
        width: 50%;
        padding: 0 10px;
    }

    /* Remove extra left and right margins, due to padding in columns */
    .row {
        display: flex;
        justify-content: space-between;

    }

    /* Clear floats after the columns */
    .row:after {
        content: "";
        display: table;
        clear: both;
    }

    /* Style the counter cards */
    .card {
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2); /* this adds the "card" effect */
        padding: 16px;
        text-align: center;
        background-color: #f1f1f1;
    }

    /* Responsive columns - one column layout (vertical) on small screens */
    @media screen and (max-width: 600px) {
        .column {
            width: 100%;
            display: block;
            margin-bottom: 20px;
        }
    }

    .title{
        font-size: 60px;
        font-family: Poppins;
    }

    .avatar {
        /*vertical-align: left;*/
        width: 100px;
        height: 100px;
        border-radius: 10%;
    }
    .search-card{
        max-width: 100px;
        max-height: 100px;
    }
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        grid-gap: 20px;
        align-items: stretch;
    }
    .grid img {
        border: 1px solid #ccc;
        box-shadow: 2px 2px 6px 0px  rgba(0,0,0,0.3);
        max-width: 100%;
    }


    .gradient-custom {
        /* fallback for old browsers */
        background: #f6d365;

        /* Chrome 10-25, Safari 5.1-6 */
        background: -webkit-linear-gradient(to right bottom, rgba(246, 211, 101, 1), rgba(253, 160, 133, 1));

        /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
        background: linear-gradient(to right bottom, rgba(246, 211, 101, 1), rgba(253, 160, 133, 1))
    }
</style>
<body>
<header th:replace="partials/header :: header"></header>
<div class="dash">
    <div class="dashbrd"><h1 class="title p-4 pb-1 pt-4">User Dashboard</h1></div>
</div>


<div class="row pt-4 mx-auto">
        <div class="card col-4 pe-3" style="max-width: 500px;">
            <div class="col col-lg-12 mb-4 mb-lg-0">
                <div class="row g-0">
                    <div class="col-md-12 gradient-custom text-center text-white"
                         style="border-top-left-radius: .5rem; border-bottom-left-radius: .5rem; border-top-right-radius: .5rem; border-bottom-right-radius: .5rem;">
                        <img class="image" th:src="${user.getProfile_picture_url().toString()}" alt="Card image cap"/>
                        <h5 class="pt-3" th:text="${user.firstName}"></h5>
                        <h5 class="pb-3" th:text="${user.lastName}"></h5>
                        <p class="pt-1 text-muted pb-2"><i class="far fa-address-card"></i> Works at</p><p class="pb-4" th:text="${user.job}"></p>
                    </div>
                    <div class="col-12">
                        <h6 class="pt-4 pb-1">Information</h6>
                        <hr class="mt-0 mb-4">
                        <div class="row pt-1">
                            <div class="col-4 mb-3">
                                <h6 class="text-muted pb-2"><i class="far fa-handshake"></i> Joined</h6>
                                <p th:text="${user.createdDate}"></p>
                            </div>
                            <div class="col-8 mb-3">
                                <h6 class="text-muted pb-2"><i class="far fa-envelope"></i> Email</h6>
                                <p th:text="${user.email}"></p>
                            </div>

                        </div>
                        <h6 class="pt-4 pb-1">About</h6>
                        <hr class="mt-0 mb-4">
                        <div class="row pt-1">
                            <div class="col-6 mb-3">
                                <h6 class="text-muted pb-2">Language Proficiency:</h6>
                                <p th:text="${user.codeLanguages}"></p>
                            </div>
                            <div class="col-6 mb-3">
                                <h6 class="text-muted pb-2">Interests</h6>
                                <p th:text="${user.aboutMe}"></p>
                            </div>
                        </div>
                        <div class="d-flex justify-content-center">
                            <form th:if="${sessionUser.getUsername() == user.username}" th:action="@{/edit/{username}(username=${#authentication.principal.username})}"
                                  class="editprofilbtn" method="get">
                                <button type="submit" class="btn btn-dark btn-block">Edit Profile</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card col-8 pe-2" style="max-width: 900px">
            <nav>
                <div class="nav nav-tabs" id="nav-tab" role="tablist" style="font-family: Poppins; font-size: 15px;">
                    <a class="nav-item nav-link active" id="nav-posts-tab" data-toggle="tab" href="#nav-posts"
                       role="tab" aria-controls="nav-posts" aria-selected="true"> Post</a>
                    <a class="nav-item nav-link" id="nav-friends-tab" data-toggle="tab" href="#nav-friends" role="tab"
                       aria-controls="nav-friends" aria-selected="false"> View Friends</a>
                    <a class="nav-item nav-link" id="nav-photos-tab" data-toggle="tab" href="#nav-photos" role="tab"
                       aria-controls="nav-photos" aria-selected="false">View Galleries</a>
                </div>
            </nav>
            <div class="tab-content" id="nav-tabContent">
                <!--       tab 1 posts -->
                <div class="tab-pane fade show active" id="nav-posts" role="tabpanel" aria-labelledby="nav-posts-tab">

                    <!--                    make a post and upload a pic-->

                    <form style="background-color: #ff5a3ce8; border-radius: 4px;"
                          th:action="@{/posts/create/{username}(username=${#authentication.principal.username})}"
                          th:object="${newPost}" method="POST" class="p-4 m-1">
                        <div class="btn-group" role="group" style="width: 100%;">
                            <input style="font-family: Poppins; font-size: 20px;" type="text" id="postBody" class="form-control" placeholder="What's new?"
                                   th:field="*{body}" required>
                            <div id="uploadPhoto">
                                <input type="hidden" id="photo" name="gallery_photo" th:field="*{photo_url}">
                                <button class="btn btn-dark btn-block m-1" style="font-family: Poppins; font-size: 15px;" id="upload">Upload</button>
                            </div>
                            <button type="submit" class="btn btn-dark btn-block m-1" style="font-family: Poppins; font-size: 15px;">Submit</button>
                        </div>
                    </form>
                    <p class="pt-1" style="font-size:30px">Recent Posts</p>
                    <div class="container">
                        <div th:each="item : ${posts}">
                            <div class="card my-3">
                                <div class="card-header container">
                                    <div class="row">
                                        <div class="col-xl-3">
                                            <a th:if="${item.getUser() != user}"
                                               th:href="@{/{username}/friend/{friendName} (friendName=${item.getUser().getUsername()}, username=${user.getUsername()})}">
                                                <img th:src="${item.getUser().getProfile_picture_url().toString()}"
                                                     class="avatar" alt="avatar">
                                            </a>
                                            <a th:if="${item.getUser() == user}"
                                               th:href="@{/user/{username} (username=${user.getUsername()})}">
                                                <img th:src="${item.getUser().getProfile_picture_url().toString()}"
                                                     class="avatar" alt="avatar">
                                            </a>
                                        </div>
                                        <div class="col-xl-9">
                                            <br>
                                            <h6 th:text="${item.getUser().getUsername()}"></h6>
                                            <div>
                                                <p th:text="'Posted on ' + ${item.getDateString()}"
                                                   style="font-size: 100%; white-space: nowrap"></p>
                                                <small class="text-muted" th:text="${item.getEditDate()}"></small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="mt-2 pt-2">
                                        <img th:if="${item.getPhoto_url()} != null" class="gallery-item-post" style="border-radius: 4px; width: 500px; height: 300px;"
                                             th:src="${item.getPhoto_url().toString()}" alt="">
                                        <p class="card-text m-1" th:text="${item.getBody()}"></p>
                                        <br>
                                        <div class="mt-2 pt-2" th:if="${item.getUser() == user}">
                                            <form style="float: left;"
                                                  th:action="@{/posts/edit/{username}/{id} (username=${user.getUsername()}, id=${item.getId()})}"
                                                  method="get">
                                                <button class="btn btn-dark btn-block" style="font-family: Poppins; font-size: 15px; float: left;" type="submit" name="edit">Edit</button>
                                            </form>
                                            <form style="float: right;"
                                                  th:action="@{/posts/delete/{username}/{id} (username=${user.getUsername()}, id = ${item.getId()})}"
                                                  th:method="post">

                                                <button class="btn btn-dark btn-block" style="font-family: Poppins; font-size: 15px; " type="submit" name="delete">Remove</button>
                                            </form>
                                            <br>
                                        </div>
                                        <form class="mt-3 pt-3 pb-3"
                                              th:action="@{/posts/create/{username}/{postId}/comment (username=${user.getUsername()}, postId=${item.getId()})}"
                                              th:object="${newComment}" method="POST">
                                            <input id="commentBody" class="form-control" th:field="*{body}" type="text"
                                                   placeholder="Comment" required>
                                            <div class="pt-2">
                                            <button type="submit" class=" pt-2 btn btn-dark btn-block" style="font-family: Poppins; float: left; font-size: 15px;">Comment</button>
                                    </div>
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <div th:each="commentItem : ${comments}">
                                <div th:if="${commentItem.getParentPost() == item}">
                                    <div class="card m-3">
                                        <div class="card-body container">
                                            <div class="row">
                                                <div class="col-4">
                                                    <a th:if="${commentItem.getUser() != user}"
                                                       th:href="@{/{username}/friend/{friendName} (friendName=${commentItem.getUser().getUsername()}, username=${user.getUsername()})}">
                                                        <img th:src="${commentItem.getUser().getProfile_picture_url().toString()}"
                                                             class="avatar" alt="avatar">
                                                    </a>
                                                    <a th:if="${commentItem.getUser() == user}"
                                                       th:href="@{/user/{username} (username=${user.getUsername()})}">
                                                        <img th:src="${commentItem.getUser().getProfile_picture_url().toString()}"
                                                             class="avatar" alt="avatar">
                                                    </a>
                                                </div>
                                                <div class="col-8">
                                                    <div class="me-auto card-title">
                                                        <p th:text="${commentItem.getUser().getUsername()}"></p>
                                                    </div>
                                                    <p th:text="'Commented ' + ${commentItem.getDateString()}"></p>
                                                    <small class="text-muted"
                                                           th:text="${commentItem.getEditDate()}"></small>
                                                    <br><br>
                                                </div>
                                            </div>
                                            <p th:text="${commentItem.getBody()}"></p>
                                            <div class="mt-2 pt-2 border-top">
                                                <div th:if="${commentItem.getUser() == user}">
                                                    <form style="float: left;"
                                                          th:action="@{/comments/edit/{username}/{commentId} (username=${#authentication.principal.username}, commentId=${commentItem.id})}"
                                                          th:object="${commentItem}" method="get">
                                                        <button type="submit" class="btn btn-secondary">Edit</button>
                                                    </form>
                                                    <form style="float: right;"
                                                          th:action="@{/comments/delete/{username}/{commentId} (username=${user.getUsername()}, commentId=${commentItem.getId()})}"
                                                          method="post">
                                                        <button type="submit" name="delete" class="btn btn-light">
                                                            Remove
                                                        </button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--       tab 2 friends-->
                <div class="tab-pane fade" id="nav-friends" role="tabpanel" aria-labelledby="nav-friends-tab">
                    <h1 class="pt-3 pb-3" style="font-family: Poppins; font-size: 25px;">Your Friends</h1>
                    <form class="pb-3" th:action="@{/users/search/{username} (username=${user.getUsername()})}" method="GET">

                        <button type="submit" class="btn btn-dark btn-block" style="font-family: Poppins; font-size: 20px;">Discover</button>
                    </form>


                    <div class="container">
                        <div class="card pt-3">
                            <div class="grid">
                        <div th:each="item : ${friends}">
                            <div th:if="${item.profile_picture_url.isEmpty()}">
                                <a th:href="@{/{username}/friend/{friendName} (username=${sessionUser.getUsername()}, friendName=${item.getUsername()})}">
                                    <img src="/img/blank-profile-picture.png">
                                </a>
                                <p class="my-1" th:text="${item.username}"></p>
                            </div>
                            <div th:if="${!item.profile_picture_url.isEmpty()}">
                                <a th:href="@{/{username}/friend/{friendName} (username=${sessionUser.getUsername()}, friendName=${item.getUsername()})}">
                                    <img th:src="${item.profile_picture_url.toString()}">
                                </a>
                                <p class="my-1" th:text="${item.username}"></p>
                            </div>
                        </div>
                            </div>
                </div>
                    </div>
                    </div>
<!--                       tab 3 galleries-->
                <div class="tab-pane fade" id="nav-photos" role="tabpanel" aria-labelledby="nav-photos-tab">
                    <h1 class="pt-3 pb-3" style="font-family: Poppins; font-size: 25px;">Your Photos</h1>
<!--                    <div style="background-color: #faf3dd;" class="row my-3">-->
                    <div class="card pt-3">
                        <div class="grid">
                        <div th:each="item : ${galleries}">
                            <div th:if="${!item.getPictures().isEmpty()}" id="thumbnail-container">
                                <a th:href="@{/{username}/gallery/{id} (username=${user.username}, id=${item.id})}">
                                    <img th:src="${item.getPictures().get(0).pictureUrl.toString()}">
                                </a>
                                <p class="my-1" th:text="${item.name}"></p>
                            </div>
                            <div th:if="${item.getPictures().isEmpty()} == true">
                                <a th:href="@{/{username}/gallery/{id} (username=${user.username}, id=${item.id})}">
                                    <img src="/img/thumbnailDefault.jpg">
                                </a>
                                <p class="my-1" th:text="${item.getName()}"></p>
                            </div>
                        </div>
                    </div>
                        </div>
                    </div>
                </div>
        </div>
        </div>
    </div>
</div>
</body>
<script src="https://code.jquery.com/jquery-2.2.4.js" integrity="sha256-iT6Q9iMJYuQiMWNd9lDyBUStIq/8PuOW33aOqmvFpqI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
        crossorigin="anonymous"></script>

<!-- JQUERY -->
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>

<!-- BOOTSTRAP -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>

<!-- JDOODLE-->
<script src="https://www.jdoodle.com/assets/jdoodle-pym.min.js" type="text/javascript"></script>
<script src="/keys.js"></script>
<script type="text/javascript" th:src="@{/js/mapbox.js}" defer></script>
<script type="text/javascript" th:src="@{/js/filestack.js}" defer></script>
</body>
</html>